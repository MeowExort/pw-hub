# PW Hub — Release Notes 0.1.1 (2025-11-03)

Небольшой релиз стабильности и UX после 0.1.0. Исправлены сохранение изменений аккаунта и сброс состояния дерева навигации, улучшено окно ввода аргументов запуска для типа "аккаунты". В серверной части добавлены метрики Telegram через OpenTelemetry.

## Ключевые изменения

### Улучшения UX (Pw.Hub)
- Редактирование аккаунта:
  - Кнопка «Сохранить» действительно сохраняет изменения в БД.
  - Сохраняется выбор персонажа по умолчанию для каждого сервера аккаунта.
  - Состояние дерева навигации (раскрытие/выбор) не сбрасывается после сохранения.
- Редактирование отряда:
  - Состояние дерева навигации сохраняется (убран полный `Reload()`).
- Окно аргументов запуска (тип "аккаунты"):
  - Аккаунты отображаются по отрядам, с заголовком‑группой (три‑состояние: всё/часть/ничего).
  - Вертикальная раскладка элементов (раньше уезжали вправо).
  - Возвращены чекбоксы для выбора аккаунтов.
  - Клик по названию отряда работает как по чекбоксу заголовка (массовое выделение/снятие).
  - Глобальные действия «Выбрать все» и «Снять все» для всех групп.

### Метрики Telegram (pw.modules.api)
- Добавлены счётчики OpenTelemetry:
  - `telegram.linked` — инкремент при успешной привязке Telegram.
  - `telegram.unlinked` — инкремент при успешной отвязке Telegram.
  - `telegram.messages.sent` — инкремент при успешной отправке сообщения в Telegram.
- Интеграция основана на существующей конфигурации OpenTelemetry и экспортируется через OTLP (без изменений в схеме БД).

## Совместимость
- Формат аргумента "аккаунты" не изменён — по‑прежнему строка с перечислением Id аккаунтов через запятую.
- Обратная совместимость сохранена; существующие Lua‑скрипты и модули продолжают работать.

## Обновление
- Обновите приложение Pw.Hub до версии 0.1.1 стандартным способом.
- Если используете свой инстанс Pw.Modules.Api, просто задеплойте обновлённый сервис — миграций БД нет.

## Технические детали
- Pw.Hub:
  - Изменения в `MainViewModel`, окнах редактирования аккаунта/отряда, `ModuleArgsWindow` (верстка и логика выбора).
  - Без миграций БД.
- Pw.Modules.Api:
  - `Features/Modules/ModuleMetrics.cs` — новые счётчики Telegram.
  - Инкремент: привязка (`Features/Auth/Telegram/ConsumeTelegramStateEndpoint.cs`), отвязка (`Features/Auth/Telegram/UnlinkTelegramEndpoint.cs`), отправка сообщения (`Infrastructure/Telegram/TelegramSender.cs`).
  - `Program.cs` уже регистрирует `Modules` Meter; добавленные метрики доступны через OTLP.

## Ссылки
- Полный журнал изменений: [Pw.Hub/CHANGELOG.md](Pw.Hub/CHANGELOG.md)
- Предыдущий релиз: [RELEASE_NOTES_0.1.0.md](RELEASE_NOTES_0.1.0.md)

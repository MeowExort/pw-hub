# PW Hub — Release Notes 0.1.0 (2025-11-02)

Это крупное обновление с архитектурным рефакторингом, интеграцией Telegram-бота, расширенными возможностями AI-помощника и множеством улучшений редактора модулей и пользовательского интерфейса.

## Ключевые изменения

### Интеграция с Telegram
- **Привязка Telegram-аккаунта**: теперь вы можете привязать свой аккаунт PW Hub к Telegram через уникальный код. После привязки вы сможете получать уведомления и управлять модулями через бота.
- **Управление через окно профиля**: кнопки «Привязать Telegram» и «Отвязать Telegram» с автоматической проверкой статуса привязки.
- **Telegram-бот**: поддержка команд `/start` и `/help` для взаимодействия с ботом.

### Расширенные возможности AI
- **Окно настроек AI**: новое окно (`AiApiKeyWindow`) для управления URL, моделью и ключом API Ollama.
- **Улучшенный AI-помощник в Lua-редакторе**:
  - Предпросмотр изменений кода в реальном времени (`DiffPreviewWindow`).
  - Автоматическое извлечение и применение кода из ответов AI.
  - Улучшенные промпты: все функции и константы объявляются в начале скрипта.
  - Красивое оформление сообщений со смайлами для Telegram.

### Редактор модулей и Lua
- **Диалог аргументов запуска**: новое окно (`RunArgsWindow`) для удобного ввода параметров перед запуском модуля.
- **Немодальное окно редактора**: теперь можно работать с редактором модулей и Lua-редактором одновременно.
- **Улучшенная работа с модулями**:
  - Автоматическая дозагрузка полных данных модуля при необходимости.
  - Отслеживание состояния сохранения (`IsSaved`).
  - Проверка установки модулей для корректного отображения кнопок «Установить»/«Удалить».
  - Автоматическое обновление списка модулей после установки/удаления.
  - Асинхронное удаление модулей с метриками.

### Архитектурный рефакторинг
- **Переход на MVVM**: завершён переход на MVVM-архитектуру с выносом бизнес-логики в ViewModel и сервисы.
- **Новые сервисы**:
  - `AccountsService` (`IAccountsService`) — CRUD-операции над отрядами и аккаунтами через EF Core.
  - `AiConfigService` (`IAiConfigService`) — управление конфигурациями AI.
  - `DiffPreviewService` — формирование unified-diff для предпросмотра изменений.
  - `AiAssistantService` и `AiDocService` — взаимодействие с AI-моделями через Ollama API.
- **Новые поведения (Behaviors)**:
  - `AutoScrollBehavior` — автопрокрутка текстовых элементов.
  - `AvalonEditTextBehavior` — привязка текста для AvalonEdit.
  - `EditorBreakpointsBehavior` — управление точками останова в Lua-редакторе.
  - `TreeViewReorderBehavior` — Drag&Drop реордер элементов TreeView (вынесено из MainWindow).

### Улучшения пользовательского интерфейса
- **Исправлена прокрутка навигационного дерева**: убран избыточный `ScrollViewer` — теперь TreeView корректно прокручивается при наведении курсора на любую часть содержимого, а не только на scrollbar.
- **Улучшенная загрузка персонажей**: обновлены CSS-селекторы и JavaScript-коды для более надёжной загрузки списка серверов и персонажей с pwonline.ru.
- **Улучшена привязка данных**: режим `OneWay` для свойств `LogText` и `ProgressValue` в окне выполнения скрипта.
- **Добавлен автовыбор созданного аккаунта/отряда**: после создания отряда или аккаунта он автоматически выбирается и прокручивается в область видимости в навигационном дереве.

### Тестирование и документация
- **Детальный тест-план**: добавлен файл `TEST_PLAN_USER.md` с подробными инструкциями для пользовательского тестирования всех функций PW Hub.

## Обновление с 0.0.10
- Обновите приложение Pw.Hub до версии 0.1.0 (иконка «Проверить обновления…» в системном трее).
- Серверная часть (если вы используете собственный инстанс Pw.Modules.Api) обновляется обычным деплоем.
- **Важно**: миграции БД были объединены — при первом запуске будет применена миграция `AddTelegram`, добавляющая поддержку Telegram-интеграции.

## Совместимость и известные вопросы
- Обратная совместимость сохранена; существующие скрипты и модули продолжают работать.
- Приложение требует .NET 8.0 или выше (Windows).
- Для работы AI-функционала требуется доступ к Ollama API (настраивается через окно настроек AI или переменную окружения `OLLAMA_API_KEY`).

## Технические детали
- Версия обновлена с 0.0.10 до 0.1.0 в `Pw.Hub.csproj`.
- Исправлен метод маршрутизации эндпоинта получения модуля: `MapPost` заменён на `MapGet`.
- Улучшена обработка пустых данных при установке и удалении модулей.
- Защита от конкурентных запросов в `RefreshBindingSafeAsync` при проверке привязки Telegram.

## Ссылки
- Полный журнал изменений: [Pw.Hub/CHANGELOG.md](Pw.Hub/CHANGELOG.md)
- Предыдущие релизы: [RELEASE_NOTES_0.0.10.md](RELEASE_NOTES_0.0.10.md), [RELEASE_NOTES_0.0.9.md](RELEASE_NOTES_0.0.9.md)
- Тест-план: [Pw.Hub/TEST_PLAN_USER.md](Pw.Hub/TEST_PLAN_USER.md)

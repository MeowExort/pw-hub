<Window x:Class="Pw.Hub.Windows.RunArgsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Pw.Hub.Windows"
        Title="Аргументы запуска" Height="500" Width="520" WindowStartupLocation="CenterOwner"
        Icon="/Assets/icon.png"
        Style="{StaticResource ModernWindowChrome}">
    <Window.Resources>
        <!-- Template for standard input types -->
        <DataTemplate x:Key="StandardInputTemplate">
            <Grid Margin="0,6,0,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding Label}" Style="{StaticResource ModernTextBlock}" VerticalAlignment="Top" Margin="0,8,0,0"/>
                <TextBox Grid.Column="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource ModernTextBox}" 
                        MinHeight="32"/>
            </Grid>
        </DataTemplate>

        <!-- Template for accounts type (multiple selection) -->
        <DataTemplate x:Key="AccountsInputTemplate">
            <Grid Margin="0,6,0,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding Label}" Style="{StaticResource ModernTextBlock}" VerticalAlignment="Top" Margin="0,8,0,0"/>
                <DockPanel Grid.Column="1">
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Выбрать все" 
                                Style="{StaticResource ModernButton}" 
                                Padding="8,4" 
                                MinWidth="100"
                                Margin="0,0,8,0"
                                Tag="{Binding}"
                                Click="SelectAllAccounts_Click"/>
                        <Button Content="Снять выбор" 
                                Style="{StaticResource ModernButton}" 
                                Padding="8,4" 
                                MinWidth="100"
                                Tag="{Binding}"
                                Click="DeselectAllAccounts_Click"/>
                    </StackPanel>
                    <ListBox ItemsSource="{Binding AvailableAccounts}"
                            SelectionMode="Multiple"
                            MinHeight="120"
                            MaxHeight="200"
                            Background="{StaticResource BackgroundSecondaryBrush}"
                            Foreground="{StaticResource TextPrimaryBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            Tag="{Binding}"
                            SelectionChanged="AccountsList_SelectionChanged">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding Email}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                <Setter Property="Padding" Value="8,4"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{StaticResource BackgroundSelectedBrush}"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{StaticResource BackgroundHoverBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </DockPanel>
            </Grid>
        </DataTemplate>

        <!-- Template for account type (single selection) -->
        <DataTemplate x:Key="AccountInputTemplate">
            <Grid Margin="0,6,0,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding Label}" Style="{StaticResource ModernTextBlock}" VerticalAlignment="Top" Margin="0,8,0,0"/>
                <ListBox Grid.Column="1"
                        ItemsSource="{Binding AvailableAccounts}"
                        SelectionMode="Single"
                        MinHeight="120"
                        MaxHeight="200"
                        Background="{StaticResource BackgroundSecondaryBrush}"
                        Foreground="{StaticResource TextPrimaryBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        Tag="{Binding}"
                        SelectionChanged="AccountsList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding Email}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                            <Setter Property="Padding" Value="8,4"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{StaticResource BackgroundSelectedBrush}"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource BackgroundHoverBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </Grid>
        </DataTemplate>

        <!-- DataTemplateSelector -->
        <local:InputTypeTemplateSelector x:Key="InputTemplateSelector"
                                        StandardTemplate="{StaticResource StandardInputTemplate}"
                                        AccountsTemplate="{StaticResource AccountsInputTemplate}"
                                        AccountTemplate="{StaticResource AccountInputTemplate}"/>
    </Window.Resources>
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Укажите значения входных параметров" Style="{StaticResource HeaderSmall}"/>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="Items" 
                         Margin="0,8,0,8"
                         ItemTemplateSelector="{StaticResource InputTemplateSelector}"/>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Отмена" Style="{StaticResource ModernButton}" MinWidth="120" Padding="14,8" IsCancel="True" Click="OnCancel" Margin="0,0,8,0"/>
            <Button Content="ОК" Style="{StaticResource PrimaryButton}" MinWidth="140" Padding="14,8" IsDefault="True" Click="OnOk"/>
        </StackPanel>
    </Grid>
</Window>